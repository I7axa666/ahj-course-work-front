{"version":3,"file":"main.js","mappings":"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","sources":["webpack://frontend/./src/js/message.js","webpack://frontend/./src/js/utilits/sender.js","webpack://frontend/./src/js/utilits/createMsgList.js","webpack://frontend/./src/js/components/previewAttach.js","webpack://frontend/./src/js/app.js","webpack://frontend/./src/js/chatWindow.js"],"sourcesContent":["export default class Message {\r\n  constructor (props) {\r\n    console.log(props);\r\n  }\r\n\r\n  static newMessage(value) {\r\n    const links = Array.from(value.matchAll(/http[s]?:\\/\\/[^\\s]+/g));\r\n    links.forEach(link => value = value.replace(link[0], `<a onclick=\"window.open('${link[0]}')\" href=\"#\">${link[0]}</a>`))\r\n    const newMessage = document.createElement('div');\r\n    newMessage.classList.add('message-container');\r\n    newMessage.innerHTML = `\r\n    <button class=\"pin-btn\">закреп</button>\r\n    <div class=\"message\">${value}</div>\r\n    <button class=\"favorite-btn\">⭐</button>\r\n    `\r\n    return newMessage\r\n  }\r\n\r\n  static newImgMessage(text, link) {\r\n    const newMessage = document.createElement('div');\r\n    newMessage.classList.add('message-container');\r\n    const img = document.createElement('img');\r\n    img.src = link;\r\n    img.alt = text;\r\n    img.classList.add('message-img');\r\n    newMessage.append(img);\r\n  \r\n    return newMessage\r\n  }\r\n}","import createMsgList from '../utilits/createMsgList'\r\nexport default class Sender {\r\n  constructor() {\r\n    this.url = 'http://localhost:3000/';\r\n    this.ws = new WebSocket('ws://localhost:3000/ws');\r\n\r\n    this.webSocketInit();\r\n  }\r\n\r\n  webSocketInit() {\r\n    this.ws.addEventListener('message', (e) => {\r\n      createMsgList(JSON.parse(e.data));      \r\n    });\r\n  }\r\n\r\n\r\n  sendAttach(attach) {\r\n    // console.log(attach)\r\n    // fetch(this.url + 'addfile/', {\r\n    //   method: 'POST',\r\n    //   body: body\r\n    // })\r\n    const body = JSON.stringify(attach)  \r\n    // console.log(attach)\r\n    this.ws.send(body);\r\n  }    \r\n\r\n  sendTxt(text) {\r\n    // fetch(this.url + 'addtext/', {\r\n    //   method: 'POST',\r\n    //   body: body\r\n    // })  \r\n\r\n    const body = JSON.stringify({\r\n      type: 'text',\r\n      text: text\r\n    });\r\n    this.ws.send(body);\r\n    \r\n  }   \r\n}","import Message from \"../message\";\r\n\r\nexport default function createMsgList (msgList) {\r\n  if (!msgList) {return}\r\n  const chatWindow = document.querySelector('.chat-window');\r\n\r\n  chatWindow.innerHTML = '';\r\n  \r\n  msgList.forEach(element => {\r\n    if (element.type === 'text') {\r\n      // console.log('text');\r\n      const newMessage = Message.newMessage(element.text);\r\n      chatWindow.append(newMessage);\r\n    } else if (element.type === 'img') {\r\n      const newMessage = Message.newImgMessage(element.text, element.attach);\r\n      chatWindow.append(newMessage);\r\n    }\r\n  });\r\n  if (!document.querySelector('.chat-window').lastElementChild) {return}  \r\n  document.querySelector('.chat-window').lastElementChild.scrollIntoView();\r\n}","\r\nexport default class PreviewAttach {\r\n  \r\n  static create (parentElement, file) {\r\n    const lastChild = parentElement.lastElementChild;\r\n    const preview = document.createElement('div');\r\n    preview.classList.add('preview');\r\n\r\n    const url = URL.createObjectURL(file);\r\n\r\n    const fileType = file.type.substring(0, file.type.indexOf(\"/\"));\r\n    if (fileType === 'image') {\r\n      const previewImg = document.createElement('img');\r\n      previewImg.src = url;\r\n      preview.appendChild(previewImg);\r\n    } else if (fileType === 'video') {\r\n      const previewVideo = document.createElement('video');\r\n      previewVideo.src = url;\r\n      previewVideo.controls = true;\r\n      preview.appendChild(previewVideo);\r\n    } else if (fileType === 'audio') {\r\n      const previewAudio = document.createElement('audio');\r\n      previewAudio.src = url;\r\n      previewAudio.controls = true;\r\n      preview.appendChild(previewAudio);\r\n    } else {\r\n      // console.log(__dirname);\r\n\r\n      const previewImg = document.createElement('img');\r\n      previewImg.src = './src/img/file.png';\r\n      preview.appendChild(previewImg);\r\n    }\r\n\r\n    parentElement.insertBefore(preview, lastChild);\r\n\r\n    setTimeout(() => {\r\n      URL.revokeObjectURL(url);\r\n    }, 0);\r\n  }\r\n\r\n}  ","import ChatWIndow from \"./chatWindow\";\r\n\r\nconst chatWindow = new ChatWIndow(document.querySelector(\".organaizer\"));\r\n\r\nchatWindow.init();\r\n\r\n\r\n\r\n","import Message from \"./message\";\r\nimport Sender from \"./utilits/sender\";\r\nimport fileToString from \"./utilits/fileToString\";\r\nimport PreviewAttach from \"./components/previewAttach\";\r\n\r\nexport default class ChatWIndow {\r\n  constructor (parentElement) {\r\n    this.parentElement = parentElement;\r\n    this.sender = new Sender();\r\n    this.myFile = null;\r\n\r\n    this.sendMessage = this.sendMessage.bind(this);\r\n    this.send = this.send.bind(this);\r\n    this.attach = this.attach.bind(this);\r\n    \r\n\r\n  }\r\n\r\n  init () {\r\n    \r\n    this.parentElement.innerHTML = `\r\n    <div class=\"chat-window\"></div>\r\n    <div class=\"chat-input\">\r\n      <input id=\"input-message\" placeholder=\"Введите сообщение\"></input>\r\n      <div class=\"buttons\">\r\n        <button class=\"send-btn\">Send</button>\r\n        <form id=\"form-attach\" class=\"attach-container\">\r\n          <input name=\"attach\" type=\"file\" class=\"attach-input\">\r\n          <span class=\"attach-icon\">+</span>\r\n        </form>\r\n        <button type=\"submit\" form=\"form-attach\" class=\"upload-btn\">Upload</button>\r\n        <button class=\"attach-btn\">Attach</button>\r\n        <button class=\"save-btn\">Save</button>\r\n        <button class=\"cancle-btn\">Cancel</button>\r\n      </div> \r\n    </div>\r\n    `;\r\n    \r\n    this.sendMessage();\r\n    this.attach();\r\n    this.draggable();\r\n  }\r\n\r\n  sendMessage () {\r\n    const sendBtn = document.querySelector('.send-btn');\r\n    sendBtn.addEventListener('click', this.send);\r\n    \r\n    document.querySelector('#input-message').addEventListener('keypress', (e) => {\r\n      if (e.key === 'Enter') {\r\n        this.send();\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  send () {\r\n    const message = document.querySelector('#input-message').value;\r\n    if (message.trim() === '') return;\r\n    const newMessage = Message.newMessage(message);\r\n\r\n    this.parentElement.querySelector('.chat-window').append(newMessage);\r\n    this.parentElement.querySelector('.chat-window').lastElementChild.scrollIntoView();\r\n    document.querySelector('#input-message').value = '';\r\n\r\n    this.sender.sendTxt(message);\r\n\r\n  }\r\n\r\n  attach(){\r\n    const attachForm = this.parentElement.querySelector('.attach-container');\r\n    const attachInput = this.parentElement.querySelector('.attach-input');\r\n    \r\n    attachForm.addEventListener('click', (e) => {\r\n      attachInput.dispatchEvent(new MouseEvent('click'));\r\n    });\r\n\r\n    attachInput.addEventListener('change', (e) => {\r\n      this.myFile = attachInput.files && attachInput.files[0];\r\n      // console.log(this.myFile.type.substring(0, this.myFile.type.indexOf(\"/\")))\r\n\r\n      if (!this.myFile) return;\r\n\r\n      PreviewAttach.create(this.parentElement, this.myFile);\r\n\r\n\r\n    // attachForm.addEventListener('submit', (e) => {\r\n    //   e.preventDefault();\r\n    //   if(!this.myFile){\r\n    //     alert('Выберите файл');\r\n    //     return;\r\n    //   }\r\n            \r\n    //   fileToString(this.myFile, (fileData) => {\r\n    //     this.sender.sendAttach({\r\n    //       type: 'img',\r\n    //       file: fileData,\r\n    //       fileName: this.myFile.name\r\n    //     });\r\n    //     document.querySelector('.preview').remove();\r\n    //     this.myFile = null;\r\n    //   })\r\n    });\r\n  }\r\n\r\n  draggable() {\r\n    const chatWindow = this.parentElement.querySelector('.chat-window');\r\n\r\n    chatWindow.addEventListener('dragover', (e) => {\r\n      e.preventDefault();\r\n    })\r\n\r\n    chatWindow.addEventListener('drop', (e) => {\r\n      e.preventDefault();\r\n\r\n      const file = e.dataTransfer.files && e.dataTransfer.files[0];\r\n      const previewImg = document.querySelector('.preview-img');\r\n\r\n      if (!file) return;\r\n\r\n      const url = URL.createObjectURL(file);\r\n      previewImg.src = url;\r\n\r\n      setTimeout(() => {\r\n        URL.revokeObjectURL(url);\r\n      }, 0);\r\n    })\r\n\r\n  }\r\n\r\n}"],"names":["Message","constructor","props","console","log","newMessage","value","Array","from","matchAll","forEach","link","replace","document","createElement","classList","add","innerHTML","newImgMessage","text","img","src","alt","append","Sender","this","url","ws","WebSocket","webSocketInit","addEventListener","e","msgList","chatWindow","querySelector","element","type","attach","lastElementChild","scrollIntoView","createMsgList","JSON","parse","data","sendAttach","body","stringify","send","sendTxt","PreviewAttach","create","parentElement","file","lastChild","preview","URL","createObjectURL","fileType","substring","indexOf","previewImg","appendChild","previewVideo","controls","previewAudio","insertBefore","setTimeout","revokeObjectURL","sender","myFile","sendMessage","bind","init","draggable","key","message","trim","attachForm","attachInput","dispatchEvent","MouseEvent","files","preventDefault","dataTransfer"],"sourceRoot":""}