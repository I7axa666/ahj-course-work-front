!function(){"use strict";class e{constructor(e){console.log(e)}static newMessage(e){Array.from(e.matchAll(/http[s]?:\/\/[^\s]+/g)).forEach((t=>e=e.replace(t[0],`<a onclick="window.open('${t[0]}')" href="#">${t[0]}</a>`)));const t=document.createElement("div");return t.classList.add("message-container"),t.innerHTML=`\n    <button class="pin-btn">закреп</button>\n    <div class="message">${e}</div>\n    <button class="favorite-btn">⭐</button>\n    `,t}static newImgMessage(e,t){const n=document.createElement("div");n.classList.add("message-container");const s=document.createElement("img");return s.src=t,s.alt=e,s.classList.add("message-img"),n.append(s),n}}class t{constructor(){this.url="http://localhost:3000/",this.ws=new WebSocket("ws://localhost:3000/ws"),this.webSocketInit()}webSocketInit(){this.ws.addEventListener("message",(t=>{!function(t){if(!t)return;const n=document.querySelector(".chat-window");n.innerHTML="",t.forEach((t=>{if("text"===t.type){const s=e.newMessage(t.text);n.append(s)}else if("img"===t.type){const s=e.newImgMessage(t.text,t.attach);n.append(s)}})),document.querySelector(".chat-window").lastElementChild&&document.querySelector(".chat-window").lastElementChild.scrollIntoView()}(JSON.parse(t.data))}))}sendAttach(e){const t=JSON.stringify(e);this.ws.send(t)}sendTxt(e){const t=JSON.stringify({type:"text",text:e});this.ws.send(t)}}class n{static create(e,t){const n=e.lastElementChild,s=document.createElement("div");s.classList.add("preview");const a=URL.createObjectURL(t),c=t.type.substring(0,t.type.indexOf("/"));if("image"===c){const e=document.createElement("img");e.src=a,s.appendChild(e)}else if("video"===c){const e=document.createElement("video");e.src=a,e.controls=!0,s.appendChild(e)}else if("audio"===c){const e=document.createElement("audio");e.src=a,e.controls=!0,s.appendChild(e)}else{const e=document.createElement("img");e.src="./src/img/file.png",s.appendChild(e)}e.insertBefore(s,n),setTimeout((()=>{URL.revokeObjectURL(a)}),0)}}new class{constructor(e){this.parentElement=e,this.sender=new t,this.myFile=null,this.sendMessage=this.sendMessage.bind(this),this.send=this.send.bind(this),this.attach=this.attach.bind(this)}init(){this.parentElement.innerHTML='\n    <div class="chat-window"></div>\n    <div class="chat-input">\n      <input id="input-message" placeholder="Введите сообщение"></input>\n      <div class="buttons">\n        <button class="send-btn">Send</button>\n        <form id="form-attach" class="attach-container">\n          <input name="attach" type="file" class="attach-input">\n          <span class="attach-icon">+</span>\n        </form>\n        <button type="submit" form="form-attach" class="upload-btn">Upload</button>\n        <button class="attach-btn">Attach</button>\n        <button class="save-btn">Save</button>\n        <button class="cancle-btn">Cancel</button>\n      </div> \n    </div>\n    ',this.sendMessage(),this.attach(),this.draggable()}sendMessage(){document.querySelector(".send-btn").addEventListener("click",this.send),document.querySelector("#input-message").addEventListener("keypress",(e=>{"Enter"===e.key&&this.send()}))}send(){const t=document.querySelector("#input-message").value;if(""===t.trim())return;const n=e.newMessage(t);this.parentElement.querySelector(".chat-window").append(n),this.parentElement.querySelector(".chat-window").lastElementChild.scrollIntoView(),document.querySelector("#input-message").value="",this.sender.sendTxt(t)}attach(){const e=this.parentElement.querySelector(".attach-container"),t=this.parentElement.querySelector(".attach-input");e.addEventListener("click",(e=>{t.dispatchEvent(new MouseEvent("click"))})),t.addEventListener("change",(e=>{this.myFile=t.files&&t.files[0],this.myFile&&n.create(this.parentElement,this.myFile)}))}draggable(){const e=this.parentElement.querySelector(".chat-window");e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(e=>{e.preventDefault();const t=e.dataTransfer.files&&e.dataTransfer.files[0],n=document.querySelector(".preview-img");if(!t)return;const s=URL.createObjectURL(t);n.src=s,setTimeout((()=>{URL.revokeObjectURL(s)}),0)}))}}(document.querySelector(".organaizer")).init()}();
//# sourceMappingURL=main.js.map